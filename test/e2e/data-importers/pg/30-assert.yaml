apiVersion: kuttl.dev/v1
kind: TestAssert
timeout: 100
collectors:
  - command: kubectl get db/test-pg-cluster -n ${NAMESPACE} -o yaml
  - command: kubectl get perconapgcluster/test-pg-cluster -n ${NAMESPACE} -o yaml
  - command: kubectl get pod/pg-client -n ${NAMESPACE} -o yaml
  - type: pod
    namespace: everest-system
    selector: control-plane=controller-manager
    tail: 100
commands:
  - command: kubectl wait --for=delete db/test-pg-cluster -n ${NAMESPACE}
  - command: kubectl wait --for=delete perconapgclusters/test-pg-cluster -n ${NAMESPACE}
  - command: kubectl wait --for=delete pod/pg-client -n $NAMESPACE
  - command: kubectl wait --for=delete pod/minio -n ${NAMESPACE}
  - command: kubectl wait --for=delete dataimporter/everest-percona-pg-operator
