apiVersion: kuttl.dev/v1
kind: TestStep
timeout: 10
commands:
  # Need to patch KUTTL's namespace to add the label so that the Everest Operator can reconcile resources from it.
  - command: kubectl patch ns ${NAMESPACE} -p '{"metadata":{"labels":{"app.kubernetes.io/managed-by":"everest"}}}' --type merge
  # We don't need the PSMDB operator to be running for the integration tests, but we need the deployment to exist otherwise the everest operator won't reconcile the CRs
  - script: "curl -fsSL https://raw.githubusercontent.com/percona/percona-server-mongodb-operator/v${PSMDB_OPERATOR_VERSION}/deploy/operator.yaml | sed 's/replicas: [0-9]/replicas: 0/g' | kubectl apply -n ${NAMESPACE} -f -"
---
apiVersion: enginefeatures.everest.percona.com/v1alpha1
kind: SplitHorizonDNSConfig
metadata:
  name: shdc-psmdb
spec:
  baseDomainNameSuffix: mycompany.com
  tls:
    secretName: shdc-secret-1
    certificate:
      tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURGRENDQWZ5Z0F3SUJBZ0lVUGJ1QWNmUTlqQldLZXI3dU9ka21hRnpqVlNZd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0lqRU9NQXdHQTFVRUNoTUZVRk5OUkVJeEVEQU9CZ05WQkFNVEIxSnZiM1FnUTBFd0hoY05NalV4TURBNQpNVEV3T1RBd1doY05NekF4TURBNE1URXdPVEF3V2pBaU1RNHdEQVlEVlFRS0V3VlFVMDFFUWpFUU1BNEdBMVVFCkF4TUhVbTl2ZENCRFFUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQUxHa1pQMlMKR3JhRERzcmZZWGd2bmk2UkdRb0t0SFNBaFNhMjR6QjJRMWpxZzh0QW16TnZINENaN0QrN2tnNUdhb1RMUkpmeApSNTRyV1kzM2k4K2I2U0F1WTNsaWRLWTVuVnZRSmtBSDNHWk5ZbkJDYkVtWllWZEFNeUN4YmIyTjNmbWFsak1SCkxsVkpVNWtpdjlYQ1pPUVEyRDFWNXRsbURHclR5aXd5RUdOeThodjlwK0tRbXdiUU5vcmxDVWw5OEEzdEw3UHUKeWxVWFk4M0ZjeUZHNzU2VDZHQTBmQndTUHJOVzBvL1Iyejl6WHZjblVEYTF2a21qR2haT3R5WjNhT1RYdnEvMgpHdklzM2N4Q0t4Uy9kVyszTFR0WWtuaHAyUkZuWllZNUg0Uzh1bTBiUmNoQ0swZWl3SkpENzNNS1ZOMWRUVm5NCmVnT0o5Y2Qwc0NiL05aY0NBd0VBQWFOQ01FQXdEZ1lEVlIwUEFRSC9CQVFEQWdFR01BOEdBMVVkRXdFQi93UUYKTUFNQkFmOHdIUVlEVlIwT0JCWUVGSG5QMU11Q3ZsVmtYWHFCdkVad0t3ZXQxK2RwTUEwR0NTcUdTSWIzRFFFQgpDd1VBQTRJQkFRQmpQZ1FjVUVZOWtOekJQTWhTN2l4V0xMMDBnVFNtaTdqVlpJNEtRVzB3NkVKYVVyN0ppemVwClNPNW1ZekRyRWlQenZUbFlKS2V3UXdVUzVKZHQwVW5Ld2JQSmljaXp2UDNBT3gvT09LZzgwYUkyeFlYVWl2engKeCt6ZzI1ZThxaGxhdXpCOEUrdklHNFowd3FsS1A1dHhsRENmU3lrNkpFdUJzVHdCZm15d1dwWWRmYTRQTEw0TwpvT3FYYXcrQkpWZTFZeExHY1poQkNmSHVoM2E2c2FndU1LanNKS0pONjVnS0tOV0lkNm5Bb2pxRkNhSVczQ0xxCkU1dC9ZWldFaVIveFRoTGk0VTluUksrRUtxeDNVSlNjSlVkKzNlMCtibzgvYXYyTlJPdFNiSmRpNEJKSWN0T0MKOWgwZmZHaUlhT3ZNdHUrTGlJTHdCSnRxZisra1libDcKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
      tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb2dJQkFBS0NBUUVBc2FSay9aSWF0b01PeXQ5aGVDK2VMcEVaQ2dxMGRJQ0ZKcmJqTUhaRFdPcUR5MENiCk0yOGZnSm5zUDd1U0RrWnFoTXRFbC9GSG5pdFpqZmVMejV2cElDNWplV0owcGptZFc5QW1RQWZjWmsxaWNFSnMKU1psaFYwQXpJTEZ0dlkzZCtacVdNeEV1VlVsVG1TSy8xY0prNUJEWVBWWG0yV1lNYXRQS0xESVFZM0x5Ry8ybgo0cENiQnRBMml1VUpTWDN3RGUwdnMrN0tWUmRqemNWeklVYnZucFBvWURSOEhCSStzMWJTajlIYlAzTmU5eWRRCk5yVytTYU1hRms2M0puZG81TmUrci9ZYThpemR6RUlyRkw5MWI3Y3RPMWlTZUduWkVXZGxoamtmaEx5NmJSdEYKeUVJclI2TEFra1B2Y3dwVTNWMU5XY3g2QTRuMXgzU3dKdjgxbHdJREFRQUJBb0lCQUJNZXJ4eXR5T3REc0QxbgpZcU1nSTVzK2Z4NmFFckhjRXJqSDJZSE1waWkxVm5SemQrRHhnUnl0M3k3b1BrQlphdVh2eDVVVkMvdDdEZnRlClNBYm9tem5IL3hQckRzUWFFbXBMUFRxMHZlVDluTzZaUlBUU1ZKYjRCWDRXS3NvZ0JyZ2RYOStQa0syWnBBSlQKcWxNcHhsaUNkRXZSdnZRL2xzUTViSEFVL3JlU3FKSFZoKzUycG9YcDZIbnhPNENURWJ5NE15ZzdoYnJoaDFmYgpWL2hMN1o1K3hhR0NqZUxWUmNMWmZENVpKYXh4OStMMlVheFplN3lLZTVlZHhGZGxhYS9vQjJlMkFTR1lnYkRaCjEwY0JsL3g2REJkc1VYckkxcTRmVXNZM3hzZitGTHAwTDNHWUFTZUlLcFpYOXNZdUN5cmx2ZTJqUnZjNm9PR0oKaVY5S2pna0NnWUVBMkJiQ29qV2pWbkFKeUZORnhlSjZxdnM1bUU1SDJBUlFOeWUvdmMvTXpKcm90WDI0ZFlkbQpOZ0hKMVdIcnltbC8yRUt5SkxOcVNqclZHdjJHN2IyM25xTDRUOUliK2FxeUtZMnN0cW9Tbks3TTlsUFN0Z2IzCmRGSDZqajc1b2ZLQjJ3RnIrNitjNENUQXRjMnpxVHcvb3BaSnJRa0ZYem1mekNWU25LckE4azhDZ1lFQTBuUEYKK0VRRHpNWUpTUFRmZW9CTE9GcXRjMHR5MkI4OTRPTHJpckFXdmIvYXZMVG9IVE4xRDB6bHFuZ1ZqQ1JBdTJ3SwpmdkZialVyT1dzU0NPbDZCYWFLMGVFVUw2U0FVT09rQlh4SDh5dnZ2NWRXZk9Jc1U5ZEpaK28yT2RtK2hWNWJkCkZvaHIvejlvd1QwOVgwNFJYUE5TeE9QMXVYUFdoa1QvZG1zY0hqa0NnWUE0UFl4QXJaY3FheFNRdCtPa0FqTU4KQnovUlBTYUR1WE9yTjBRM1FiczYwV0tad2ZQZFd2VW1QMGJwcTRlejhjdGRYTmFDcU5PVUtFWEl0WTJGbU9nTwplTG9LQkZSVm9iQ25FZ0dPdFNzTTdvM1gycTh2d3hacWh0K2dZQkdXcmNoUVdNbGpBeXpnUlpDR2dOZ3V4c2lGCkozcGJkOHFYSXlkTStiWExvc0YvRHdLQmdFbWNPeE9TWHEzaVd0OE0zNW9PZzhEclhwM2tOd0JITlRLU3pJWk8KL3pWUmhPWGFkUkc1ck9rMElXVFY2ZHVCMXE1M3BOZ3YvYkRYQ0lTUkZXZnJKR0xaaVR4RUVsMXhYZ0ZsNXBmbApSOEdNQzZZZGFUcXkweHNFZjNwMnh1ekFNUFBkRGVuU3Y4dWcxemczL2w1MmhQWTVHYXRLZk9sb0RoSWEwaXdPClhPQnBBb0dBVEJBSmFRbHE3R1A0dHBwWVpFV0ozMzlva3gzNnpyYkprbERXcDVYTTBrRXBKb2R3dWFvcE5obzMKb0hiUnZISXhZK3IwWjVabUlNMFVQeC9UblBIMS9FeHNXZ3Z2c0V5TUgyTzN5NUJFaWFVY1dDVGZLRTR5UXNIYQowR09acEhHUzRMZ3JKSHZrZExrVzJtRXVnY25ETEUrT2FBa0VIQTZmOFBWOVVoRzh0bTA9Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
      ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURGRENDQWZ5Z0F3SUJBZ0lVUGJ1QWNmUTlqQldLZXI3dU9ka21hRnpqVlNZd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0lqRU9NQXdHQTFVRUNoTUZVRk5OUkVJeEVEQU9CZ05WQkFNVEIxSnZiM1FnUTBFd0hoY05NalV4TURBNQpNVEV3T1RBd1doY05NekF4TURBNE1URXdPVEF3V2pBaU1RNHdEQVlEVlFRS0V3VlFVMDFFUWpFUU1BNEdBMVVFCkF4TUhVbTl2ZENCRFFUQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQUxHa1pQMlMKR3JhRERzcmZZWGd2bmk2UkdRb0t0SFNBaFNhMjR6QjJRMWpxZzh0QW16TnZINENaN0QrN2tnNUdhb1RMUkpmeApSNTRyV1kzM2k4K2I2U0F1WTNsaWRLWTVuVnZRSmtBSDNHWk5ZbkJDYkVtWllWZEFNeUN4YmIyTjNmbWFsak1SCkxsVkpVNWtpdjlYQ1pPUVEyRDFWNXRsbURHclR5aXd5RUdOeThodjlwK0tRbXdiUU5vcmxDVWw5OEEzdEw3UHUKeWxVWFk4M0ZjeUZHNzU2VDZHQTBmQndTUHJOVzBvL1Iyejl6WHZjblVEYTF2a21qR2haT3R5WjNhT1RYdnEvMgpHdklzM2N4Q0t4Uy9kVyszTFR0WWtuaHAyUkZuWllZNUg0Uzh1bTBiUmNoQ0swZWl3SkpENzNNS1ZOMWRUVm5NCmVnT0o5Y2Qwc0NiL05aY0NBd0VBQWFOQ01FQXdEZ1lEVlIwUEFRSC9CQVFEQWdFR01BOEdBMVVkRXdFQi93UUYKTUFNQkFmOHdIUVlEVlIwT0JCWUVGSG5QMU11Q3ZsVmtYWHFCdkVad0t3ZXQxK2RwTUEwR0NTcUdTSWIzRFFFQgpDd1VBQTRJQkFRQmpQZ1FjVUVZOWtOekJQTWhTN2l4V0xMMDBnVFNtaTdqVlpJNEtRVzB3NkVKYVVyN0ppemVwClNPNW1ZekRyRWlQenZUbFlKS2V3UXdVUzVKZHQwVW5Ld2JQSmljaXp2UDNBT3gvT09LZzgwYUkyeFlYVWl2engKeCt6ZzI1ZThxaGxhdXpCOEUrdklHNFowd3FsS1A1dHhsRENmU3lrNkpFdUJzVHdCZm15d1dwWWRmYTRQTEw0TwpvT3FYYXcrQkpWZTFZeExHY1poQkNmSHVoM2E2c2FndU1LanNKS0pONjVnS0tOV0lkNm5Bb2pxRkNhSVczQ0xxCkU1dC9ZWldFaVIveFRoTGk0VTluUksrRUtxeDNVSlNjSlVkKzNlMCtibzgvYXYyTlJPdFNiSmRpNEJKSWN0T0MKOWgwZmZHaUlhT3ZNdHUrTGlJTHdCSnRxZisra1libDcKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
