apiVersion: kuttl.dev/v1
kind: TestStep
timeout: 10
commands:
  # We need to apply if via a script so that we can set the engine version, otherwise the DB reconciliation will fail.
  - script: |
      cat <<EOF | kubectl apply -f -
      apiVersion: everest.percona.com/v1alpha1
      kind: DatabaseCluster
      metadata:
        name: test-pg-cluster
        namespace: "${NAMESPACE}"
      spec:
        engine:
          type: postgresql
          replicas: 2
          storage:
            size: 1Gi
          version: "${PREVIOUS_PG_DB_ENGINE_VERSION}"
        proxy:
          type: pgbouncer
          replicas: 2
      EOF