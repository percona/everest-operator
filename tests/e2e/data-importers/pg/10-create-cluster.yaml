apiVersion: kuttl.dev/v1
kind: TestStep
commands:
  - script: |
      cat <<EOF | kubectl apply -f -
      apiVersion: everest.percona.com/v1alpha1
      kind: DatabaseCluster
      metadata:
        name: test-pg-cluster
        namespace: ${NAMESPACE}
      spec:
        dataSource:
          dataImport:
            dataImporterName: everest-percona-pg-operator
            source:
              path: "/pg/backup/db/20250702-131148F"
              s3:
                bucket: everest-operator
                region: us-east-1
                endpointURL: https://minio.${NAMESPACE}.svc
                credentialsSecretName: test-s3-secret
                accessKeyId: minioadmin
                secretAccessKey: minioadmin
                verifyTLS: false
                forcePathStyle: true
        engine:
          type: postgresql
          replicas: 3
          storage:
            size: 15G
          resources:
            cpu: "1"
            memory: 1G
          userSecretsName: test-pg-cluster-user-secret
        proxy:
          type: pgbouncer
          replicas: 3
      EOF