apiVersion: kuttl.dev/v1
kind: TestStep
timeout: 60
commands:
  - script: kubectl -n $NAMESPACE delete db test-pg-cluster --wait=false && sleep 5
  - command: kubectl patch postgresclusters test-pg-cluster -n $NAMESPACE -p '{"metadata":{"finalizers":null}}' --type merge
    ignoreFailure: true
  - command: kubectl patch pg test-pg-cluster -n $NAMESPACE -p '{"metadata":{"finalizers":null}}' --type merge
    ignoreFailure: true
  - command: kubectl wait --for=delete db test-pg-cluster --timeout=60s -n $NAMESPACE
  - command: kubectl delete pod pg-client -n $NAMESPACE --wait