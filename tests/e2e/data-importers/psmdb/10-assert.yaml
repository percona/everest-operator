apiVersion: kuttl.dev/v1
kind: TestAssert
timeout: 100
collectors:
  - command: kubectl get db/test-psmdb-cluster -n ${NAMESPACE} -o yaml
  - command: kubectl get psmdb/test-psmdb-cluster -n ${NAMESPACE} -o yaml
  - type: pod
    namespace: everest-system
    selector: control-plane=controller-manager
    tail: 100
commands:
  - command: kubectl wait --for=jsonpath='{.spec.dataSource.dataImport.source.s3.endpointURL}'='https://minio.${NAMESPACE}.svc' db/test-psmdb-cluster -n ${NAMESPACE}
---
apiVersion: everest.percona.com/v1alpha1
kind: DatabaseCluster
metadata:
  name: test-psmdb-cluster
spec:
  dataSource:
    dataImport:
      dataImporterName: everest-percona-psmdb-operator
      source:
        path: "/psmdb/2025-07-10T14:05:57Z"
        s3:
          bucket: everest-operator
          region: us-east-1
          credentialsSecretName: test-s3-secret
          verifyTLS: false
          forcePathStyle: true
  engine:
    replicas: 3
    type: psmdb
  proxy:
    replicas: 3
status:
  status: initializing
---
apiVersion: psmdb.percona.com/v1
kind: PerconaServerMongoDB
metadata:
  name: test-psmdb-cluster
status:
  state: initializing
