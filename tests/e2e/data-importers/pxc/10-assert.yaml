apiVersion: kuttl.dev/v1
kind: TestAssert
timeout: 100
collectors:
  - command: kubectl get db/test-pxc-cluster -n ${NAMESPACE} -o yaml
  - command: kubectl get pxc/test-pxc-cluster -n ${NAMESPACE} -o yaml
  - type: pod
    namespace: everest-system
    selector: control-plane=controller-manager
    tail: 100
  - type: pod
    selector: app.kubernetes.io/name=percona-xtradb-cluster-operator
    tail: 100
---
apiVersion: v1
kind: Secret
metadata:
  name: test-s3-secret
data:
  AWS_ACCESS_KEY_ID: bWluaW9hZG1pbg==     # minioadmin
  AWS_SECRET_ACCESS_KEY: bWluaW9hZG1pbg== # minioadmin
---
apiVersion: everest.percona.com/v1alpha1
kind: DatabaseCluster
metadata:
  name: test-pxc-cluster
spec:
  dataSource:
    dataImport:
      dataImporterName: everest-percona-pxc-operator
      source:
        path: "/pxc/test-pxc-2025-09-30-11:18:45-full"
        s3:
          endpointURL: https://minio.minio.svc
          bucket: everest-operator
          region: us-east-1
          credentialsSecretName: test-s3-secret
          verifyTLS: false
          forcePathStyle: true
  engine:
    replicas: 3
    type: pxc
  proxy:
    replicas: 3
status:
  status: initializing
---
apiVersion: pxc.percona.com/v1
kind: PerconaXtraDBCluster
metadata:
  name: test-pxc-cluster
spec:
  pxc:
    size: 3
  haproxy:
    size: 3
status:
  state: initializing
