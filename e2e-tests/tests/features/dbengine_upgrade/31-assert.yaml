apiVersion: kuttl.dev/v1
kind: TestAssert
timeout: 300
commands:
  # check that the annotation is removed
  - script: >
      test "$(kubectl get dbengine percona-xtradb-cluster-operator -n $NAMESPACE -o jsonpath='{.metadata.annotations}')" = ""
  # check that there are no pending upgrades
  - script: >
      test "$(kubectl get dbengine percona-xtradb-cluster-operator -n $NAMESPACE -o jsonpath='{.status.pendingOperatorUpgrades}')" = ""
  # check that the operator version is updated
  - script: >
      test "$(kubectl get dbengine percona-xtradb-cluster-operator -n $NAMESPACE -o jsonpath='{.status.operatorVersion}')" = ${PXC_OPERATOR_VERSION}
  # check that there is a new recommended CR Version
  - script: >
      test "kubectl get db test-pxc-cluster -n ${NAMESPACE} -o jsonpath='{.status.recommendedCRVersion}'" = ${PXC_OPERATOR_VERSION}
